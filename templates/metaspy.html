{% extends "base.html" %}
{% block content %}

<!-- ================= METASPY HEADER ================= -->
<div class="pg-header-row">

    <div class="pg-header-left">
        <a href="{{ url_for('reconnaissance') }}" class="pg-back-btn">← Back</a>

        <div>
            <h1 class="page-title">MetaSpy</h1>
            <p class="page-desc">
                Passive file and image metadata intelligence & forensic analysis
            </p>
        </div>
    </div>

</div>

<div class="divider"></div>

<!-- ================= UPLOAD PANEL ================= -->
<form action="{{ url_for('metaspy') }}"
      method="POST"
      enctype="multipart/form-data"
      class="ms-upload-panel">

    <div class="ms-upload-row">
        <input
            type="file"
            name="file"
            accept=".jpg,.jpeg,.png,.tif,.tiff,.pdf,.docx"
            class="ms-file-input"
            required
        >

        <button type="submit" class="ms-btn primary">
            Analyze
        </button>
    </div>

    <div class="ms-options">
        <label>
            <input type="checkbox" name="stego" checked>
            Steganography Detection
        </label>

        <label>
            <input type="checkbox" name="integrity" checked>
            Image Integrity Check
        </label>
    </div>

    <div class="ms-note">
        ✔ Passive analysis only · No external APIs · No data modification
    </div>

</form>

<!-- ================= RESULTS ================= -->
{% if target %}
<div class="divider"></div>

<section class="ms-results">

    <h3 class="ms-subtitle">Results — {{ target }}</h3>

    {% if result.error %}
        <div class="ms-error">
            Error: {{ result.error }}
        </div>
    {% endif %}

    <div class="ms-kv"><b>Filename</b><span>{{ result.filename }}</span></div>
    <div class="ms-kv"><b>File size</b><span>{{ result.file_size }} bytes</span></div>
    <div class="ms-kv"><b>Type</b><span>{{ result.type }} ({{ result.mime }})</span></div>
    <div class="ms-kv"><b>FS created</b><span>{{ result.fs_created }}</span></div>
    <div class="ms-kv"><b>FS modified</b><span>{{ result.fs_modified }}</span></div>

    <h4 class="ms-section-title">Extracted Intelligence</h4>

    {% if result.metadata %}
        <ul class="ms-meta-list">
            {% for k, v in result.metadata.items() %}
                <li>
                    <strong>{{ k }}</strong>:
                    {% if v is mapping %}
                        <pre class="ms-pre">{{ v | tojson(indent=2) }}</pre>
                    {% else %}
                        <span class="ms-meta-value">{{ v }}</span>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <div class="ms-note">No metadata found.</div>
    {% endif %}

</section>
{% endif %}

{% endblock %}
