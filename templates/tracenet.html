{% extends "base.html" %}
{% block content %}

<!-- ================= TRACENET HEADER ================= -->
<div class="pg-header-row">

    <div class="pg-header-left">
        <a href="{{ url_for('reconnaissance') }}" class="pg-back-btn">← Back</a>

        <div>
            <h1 class="page-title">TraceNet Recon</h1>
            <p class="page-desc">
                Passive OSINT reconnaissance for usernames and email addresses
            </p>
        </div>
    </div>

</div>

<div class="divider"></div>

<!-- ================= SCAN FORM ================= -->
<form method="POST" class="tn-form">

    <input
        type="text"
        name="target"
        class="tn-input"
        placeholder="Enter username or email"
        value="{{ target or '' }}"
        required
    >

    <button type="submit" class="tn-btn primary">
        Scan
    </button>

</form>

<div class="tn-note">
    Passive OSINT only · No exploitation · No active scanning
</div>

<!-- ================= RESULTS ================= -->
{% if target %}
<div class="divider"></div>

<section class="tn-results">

    <h3 class="tn-subtitle">
        Results for <span class="tn-target">{{ target }}</span>
    </h3>

    {% if result and result.type == 'username' %}

        <table class="pg-table">
            <thead>
                <tr>
                    <th>Platform</th>
                    <th>Profile URL</th>
                    <th>Status</th>
                    <th>HTTP</th>
                </tr>
            </thead>
            <tbody>
            {% for r in result.results %}
                <tr class="{% if r.found %}safe{% else %}warn{% endif %}">
                    <td>{{ r.platform }}</td>
                    <td>
                        <a href="{{ r.url }}" target="_blank" class="tn-link">
                            {{ r.url }}
                        </a>
                    </td>
                    <td>
                        {% if r.found %}
                            <span class="risk safe">Found</span>
                        {% else %}
                            <span class="risk high">Not Found</span>
                        {% endif %}
                    </td>
                    <td>{{ r.http_status or '—' }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>

    {% elif result and result.type == 'email' %}

        {% if result.status == 'no_api' %}
            <div class="tn-alert warn">
                HIBP API key not configured.
            </div>

        {% elif result.status == 'ok' and result.breaches|length == 0 %}
            <div class="tn-alert safe">
                No breaches found.
            </div>

        {% elif result.status == 'ok' %}
            <ul class="tn-breach-list">
                {% for b in result.breaches %}
                    <li>
                        <strong>{{ b.Name }}</strong>
                        <span>{{ b.BreachDate }}</span>
                    </li>
                {% endfor %}
            </ul>

        {% else %}
            <div class="tn-alert warn">
                Error checking breach data.
            </div>
        {% endif %}

    {% endif %}

</section>
{% endif %}

{% endblock %}
