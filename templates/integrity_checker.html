{% extends "base.html" %}
{% block content %}

<!-- ================= INTEGRITY CHECKER HEADER ================= -->
<div class="pg-header-row">

    <div class="pg-header-left">
        <a href="{{ url_for('system_security') }}" class="pg-back-btn">‚Üê Back</a>

        <div>
            <h1 class="page-title">Integrity Checker</h1>
            <p class="page-desc">
                Detect unauthorized modifications to critical system and user-selected files
            </p>
        </div>
    </div>

</div>

<div class="divider"></div>

<!-- ================= ACTION BUTTONS ================= -->
<form method="POST" class="ic-actions">
    <button type="submit" name="action" value="create_baseline" class="ic-btn primary">
        Create Baseline
    </button>

    <button type="submit" name="action" value="scan" class="ic-btn secondary">
        Run Integrity Scan
    </button>
</form>

<form method="POST" class="ic-actions">
    <input type="text"
           name="custom_file"
           class="ic-input"
           placeholder="Enter full file path (e.g. config/settings.json)">
    <button type="submit" name="action" value="add_custom" class="ic-btn primary">
        Add Custom File
    </button>
</form>

<!-- ================= CUSTOM FILE LIST ================= -->
{% if custom_files %}
<div class="ic-custom-list">
    <strong>Custom Files</strong>
    <ul>
        {% for f in custom_files %}
        <li>
            <span>{{ f }}</span>
            <form method="POST">
                <input type="hidden" name="file_path" value="{{ f }}">
                <button type="submit"
                        name="action"
                        value="remove_custom"
                        class="ic-btn danger small">
                    Remove
                </button>
            </form>
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<!-- ================= MESSAGE ================= -->
{% if message %}
<div class="ic-message">{{ message }}</div>
{% endif %}

<!-- ================= RESULTS TABLE ================= -->
{% if results %}
<section class="ic-table-wrap">
    <table class="pg-table">
        <thead>
            <tr>
                <th>File</th>
                <th>Status</th>
                <th>Integrity</th>
            </tr>
        </thead>
        <tbody>
            {% for r in results %}
            <tr class="{% if r.integrity != 'OK' %}risk{% endif %}">
                <td>{{ r.file }}</td>
                <td>{{ r.status }}</td>
                <td>
                    {% if r.integrity == "OK" %}
                        <span class="risk safe">OK</span>
                    {% else %}
                        <span class="risk high">{{ r.integrity }}</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>
{% endif %}

{% endblock %}
