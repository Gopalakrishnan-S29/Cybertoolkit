{% extends "base.html" %}
{% block content %}

<!-- ================= CRAWLEYE HEADER ================= -->
<div class="pg-header-row">

    <div class="pg-header-left">
        <a href="{{ url_for('reconnaissance') }}" class="pg-back-btn">← Back</a>

        <div>
            <h1 class="page-title">CrawlEye</h1>
            <p class="page-desc">
                Passive website surface mapping and exposed endpoint discovery
            </p>
        </div>
    </div>

</div>

<div class="divider"></div>

<!-- ================= CRAWL BOX ================= -->
<form method="POST" class="ce-crawl-box">

    <h3 class="ce-title">Crawl a Website</h3>
    <p class="ce-desc">
        Enter a target URL and maximum pages to crawl.
        Passive discovery only — no exploitation.
    </p>

    <div class="ce-inputs">
        <input
            type="text"
            name="target"
            class="ce-input"
            placeholder="https://example.com"
            required
            value="{{ target or '' }}"
        >

        <input
            type="number"
            name="depth"
            class="ce-input depth"
            value="{{ depth or 50 }}"
            min="10"
            max="200"
        >

        <button type="submit" class="ce-btn primary">
            Start Crawl
        </button>
    </div>

</form>

<!-- ================= RESULTS ================= -->
{% if result %}
<div class="divider"></div>

<section class="ce-results">

    <h3 class="ce-subtitle">
        Target <span class="ce-target">{{ result.base_url }}</span>
    </h3>

    <div class="ce-meta">
        Total Pages Discovered: {{ result.total_urls }}
    </div>

    <!-- Sensitive Paths -->
    <h4 class="ce-section-title">Sensitive Paths Detected</h4>

    {% if result.sensitive %}
        <ul class="ce-alert-list">
            {% for s in result.sensitive %}
                <li class="high">
                    {{ s.path }} ({{ s.status }})
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <div class="ce-ok">No common sensitive paths detected</div>
    {% endif %}

    <!-- robots.txt -->
    <h4 class="ce-section-title">robots.txt Disallowed Paths</h4>

    {% if result.robots %}
        <ul class="ce-list">
            {% for r in result.robots %}
                <li>{{ r }}</li>
            {% endfor %}
        </ul>
    {% else %}
        <div class="ce-muted">No disallowed paths found</div>
    {% endif %}

    <!-- sitemap.xml -->
    <h4 class="ce-section-title">sitemap.xml URLs</h4>

    {% if result.sitemap %}
        <ul class="ce-list">
            {% for s in result.sitemap %}
                <li>
                    <a href="{{ s }}" target="_blank" class="ce-link">
                        {{ s }}
                    </a>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <div class="ce-muted">No sitemap.xml found</div>
    {% endif %}

    <!-- Discovered URLs -->
    <h4 class="ce-section-title">Discovered URLs</h4>

    <table class="pg-table">
        <thead>
            <tr>
                <th>#</th>
                <th>URL</th>
                <th>Type</th>
            </tr>
        </thead>
        <tbody>
        {% for u in result.urls %}
            <tr class="{% if 'admin' in u or 'login' in u or 'config' in u %}risk{% endif %}">
                <td>{{ loop.index }}</td>
                <td>
                    <a href="{{ u }}" target="_blank" class="ce-link">
                        {{ u }}
                    </a>
                </td>
                <td>
                    {% if 'admin' in u or 'login' in u or 'config' in u %}
                        <span class="risk high">High-Value</span>
                    {% else %}
                        <span class="risk safe">Normal</span>
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

</section>
{% endif %}

{% endblock %}
